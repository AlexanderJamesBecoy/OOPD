!function(e){function t(n){if(a[n])return a[n].exports;var s=a[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var a={};t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=1)}({1:function(e,t,a){a("Vw7+"),a("IqYM"),a("Fnav"),e.exports=a("OdLo")},FeBl:function(e,t){var a=e.exports={version:"2.5.0"};"number"==typeof __e&&(__e=a)},Fnav:function(e,t,a){"use strict";var n=React.createClass({displayName:"GroupConversation",_openConversation:function(){ChatActions.addConversation(this.props.conversation.id_hashed,!0)},render:function(){return React.createElement("li",null,React.createElement("a",{className:"ellipsis",onClick:this._openConversation,target:"_blank"},React.createElement("img",{src:BASE_URL+"/img/placeholders/avatars/no_group_64.jpg",alt:"avatar",className:"img-circle"}),React.createElement("span",null,this.props.conversation.name)))}}),s=React.createClass({displayName:"OnlineContact",_openConversation:function(){ChatActions.addUserConversation(this.props.contact.id_hashed,!0)},render:function(){return React.createElement("li",null,React.createElement("a",{className:"ellipsis",onClick:this._openConversation,target:"_blank"},React.createElement("img",{src:this.props.contact.avatar_small_url,alt:"avatar",className:"img-circle"}),React.createElement("span",null,this.props.contact.name)))}}),i=React.createClass({displayName:"OfflineContact",_openConversation:function(){ChatActions.addUserConversation(this.props.contact.id_hashed,!0)},render:function(){return React.createElement("li",null,React.createElement("a",{className:"ellipsis",onClick:this._openConversation,target:"_blank"},React.createElement("img",{src:this.props.contact.avatar_small_url,alt:"avatar",className:"img-circle"}),React.createElement("span",null,this.props.contact.name)))}}),o=[],c=React.createClass({displayName:"Contacts",mixins:[Reflux.connect(ContactsStore,"contacts")],_filterContacts:function(){var e=this.refs.contacts_filter_input.value;ContactActions.findContact(e)},_newGroupConversation:function(){window.$("#new-groupconversation-modal").modal("show")},_toggleGroups:function(){ContactActions.toggleGroups()},_toggleOnline:function(){ContactActions.toggleOnline()},_toggleOffline:function(){ContactActions.toggleOffline()},componentWillMount:function(){this.props.channel.bind("user-status-change",function(e){var t=e[0];if(1==t.online_status){var a=_.find(o,function(e){return e.id_hashed==t.id_hashed});a&&(clearTimeout(a.timeout),o=_.without(o,_.findWhere(o,{id_hashed:t.id_hashed}))),ContactActions.addOnlineContact(t),ChatActions.addOnlineContact(t)}else o.push({id_hashed:t.id_hashed,timeout:setTimeout(function(){ContactActions.removeOnlineContact(t),ChatActions.removeOnlineContact(t)},5e3)})}),ContactActions.getConversations(),ContactActions.getTotalContactsAmount()},render:function(){var e=_.map(this.state.contacts.foundContacts,function(e){return 1==e.online_status?React.createElement(s,{key:e.id_hashed,contact:e}):React.createElement(i,{key:e.id_hashed,contact:e})}),t="";this.state.contacts.filterValue.length>0&&e.length<1&&(t=React.createElement("li",{className:"contacts-search-no-results text-center"},translate_no_results_found));var a=_.map(this.state.contacts.groupConversations,function(e){return React.createElement(n,{conversation:e,key:e.id_hashed})}),o=[],c=[];_.each(this.state.contacts.contacts,function(e,t){1==e.online_status?c.push(React.createElement(s,{key:e.id_hashed,contact:e})):o.push(React.createElement(i,{key:e.id_hashed,contact:e}))});var r=this.state.contacts.totalContacts-c.length;return React.createElement("div",null,React.createElement("div",{className:"chat-form"},React.createElement("input",{type:"text",onKeyUp:this._filterContacts,ref:"contacts_filter_input",className:"form-control form-control-borderless",placeholder:translate_conversations_search_contact})),React.createElement("ul",{className:"sidebar-nav",style:{padding:"10px 0"}},e,t),React.createElement("span",{className:"sidebar-title"},React.createElement("i",{onClick:this._newGroupConversation,className:"fa fa-plus-circle pull-right add-group-conversation-btn"}),React.createElement("strong",{className:"pointer",onClick:this._toggleGroups},translate_conversations_groups," ",React.createElement("small",null,"(",a.length,")"))),React.createElement("ul",{className:"sidebar-nav",style:{padding:"10px 0"}},this.state.contacts.showGroups?a:""),React.createElement("span",{className:"sidebar-title"},React.createElement("strong",{className:"pointer",onClick:this._toggleOnline},translate_conversations_online," ",React.createElement("small",null,"(",c.length,")"))),React.createElement("ul",{className:"sidebar-nav",style:{padding:"10px 0"}},this.state.contacts.showOnline?c:""),React.createElement("span",{className:"sidebar-title"},React.createElement("strong",{className:"pointer",onClick:this._toggleOffline},translate_conversations_offline," ",React.createElement("small",null,"(",o.length,"/",r,")"))),React.createElement("ul",{className:"sidebar-nav",style:{padding:"10px 0"}},this.state.contacts.showOffline?o:""))}});localStorageAvailable()?ReactDOM.render(React.createElement(c,{channel:pusherUserChannel}),document.getElementById("contacts-container")):document.getElementById("btn-sidebar-toggle").style.display="none"},IqYM:function(e,t,a){"use strict";var n=a("mvHQ"),s=function(e){return e&&e.__esModule?e:{default:e}}(n);window.ContactActions=Reflux.createActions(["addContact","addOnlineContact","removeOnlineContact","isUserOnline","findContact","getTotalContactsAmount","getConversations","addGroupConversation","removeGroupConversation","renameGroupConversation","toggleOnline","toggleGroups","toggleOffline"]);window.ContactsStore=Reflux.createStore({xhrSearchContacts:null,ownUserId:AUTH_USER_ID,listenables:[ContactActions],onRenameGroupConversation:function(e){_.extend(_.findWhere(this.groupConversations,{id_hashed:e.id_hashed}),e),this.updateState()},onRemoveGroupConversation:function(e){this.groupConversations=$.grep(this.groupConversations,function(t){return t.id_hashed!==e}.bind(this)),this.updateState()},onAddGroupConversation:function(e,t){this.groupConversations.push(e),ChatActions.addConversation(e.id_hashed,t),this.updateState()},onGetConversations:function(){$.get(BASE_URL+"/user/conversations",function(e){_.each(e,function(e){if(e.unread&&ChatActions.addConversation(e.id_hashed),1==e.isgroup)this.groupConversations.push(e);else{var t=_.find(this.contacts,function(t){return t.id_hashed===e.members[0].id_hashed});t||(t=e.members[0],this.contacts.push(t)),1==t.online_status&&ChatActions.addOnlineContact(t)}}.bind(this)),this.updateState()}.bind(this))},onAddContact:function(e){var t=_.find(this.contacts,function(t){return t.id_hashed===e.id_hashed});t?(t=e,this.updateState()):(this.contacts.push(e),this.updateState())},onAddOnlineContact:function(e){var t=_.find(this.contacts,function(t){return t.id_hashed===e.id_hashed});t?t.online_status=1:this.contacts.push(e),this.updateState()},onRemoveOnlineContact:function(e){var t=_.find(this.contacts,function(t){return t.id_hashed===e.id_hashed});t&&(t.online_status=0,this.updateState())},onFindContact:function(e){this.xhrSearchContacts&&this.xhrSearchContacts.abort(),e.length>0?this.xhrSearchContacts=$.post(BASE_URL+"/user/search-contacts",{filter:e},function(t){_.map(t,function(e){var t=_.find(this.contacts,function(t){return t.id_hashed===e.id_hashed});t&&(e.online_status=t.online_status)}.bind(this)),this.foundContacts=t,this.filterValue=e,this.updateState()}.bind(this)):(this.filterValue="",this.foundContacts=[],this.updateState())},onGetTotalContactsAmount:function(){$.get(BASE_URL+"/user/total-contacts",function(e){this.totalContacts=e,this.updateState()}.bind(this))},onToggleOnline:function(){this.showOnline=!this.showOnline,this.updateState()},onToggleOffline:function(){this.showOffline=!this.showOffline,this.updateState()},onToggleGroups:function(){this.showGroups=!this.showGroups,this.updateState()},updateState:function(){localStorageAvailable()&&localStorage.setItem("active_contacts",(0,s.default)({showOffline:this.showOffline,showOnline:this.showOnline,showGroups:this.showGroups})),this.trigger({groupConversations:this.groupConversations,contacts:this.contacts,totalContacts:this.totalContacts,foundContacts:this.foundContacts,filterValue:this.filterValue,showOffline:this.showOffline,showOnline:this.showOnline,showGroups:this.showGroups})},getInitialState:function(){if(localStorageAvailable())var e=localStorage.getItem("active_contacts");else var e=!1;return this.groupConversations=[],this.contacts=[],this.totalContacts=0,this.foundOfflineContacts=[],this.filterValue="",e?(e=JSON.parse(e),this.showOffline=e.showOffline,this.showOnline=e.showOnline,this.showGroups=e.showGroups):(this.showOffline=!0,this.showOnline=!0,this.showGroups=!0),{groupConversations:this.groupConversations,contacts:this.contacts,totalContacts:this.totalContacts,foundContacts:this.foundContacts,filterValue:this.filterValue,showOffline:this.showOffline,showOnline:this.showOnline,showGroups:this.showGroups}}})},OdLo:function(e,t,a){"use strict";var n=React.createClass({displayName:"Chat",mixins:[Reflux.connect(ChatStore,"chat")],_addMessage:function(e){var t=this.refs.message_input.value.trim(),a=this;"click"==e.type||13===e.which&&t&&e.shiftKey?($.post(BASE_URL+"/convs/message",{conversation_id:this.state.chat.activeConversation.id_hashed,message:t},function(e){if(ChatActions.addMessage(e),0==a.state.chat.activeConversation.isgroup){var t=_.find(a.state.chat.activeConversation.users,function(e){return e.id_hashed!=AUTH_HASH_ID});t&&ContactActions.addContact(t)}}),this.refs.message_input.value=""):27===e.which?this.refs.message_input.value="":t.length<1&&(this.refs.message_input.value="")},_toggleMinimized:function(){ChatActions.toggleMinimized()},_closeConversation:function(){ChatActions.closeConversation()},_activeConversation:function(e){ChatActions.setActiveConversation(e,!0)},_toggleAddUsers:function(){ChatActions.toggleAddingUsers()},_filterContacts:function(){var e=this.refs.contactFilterInput.value;this.xhrSearchContacts&&this.xhrSearchContacts.abort(),e.length>0?this.xhrSearchContacts=$.post(BASE_URL+"/user/search-contacts",{filter:e},function(t){this.setState({contacts:t,filter:e})}.bind(this)):this.setState({filter:"",contacts:[]})},_addUserToConversation:function(e){$.post(BASE_URL+"/convs/add-user/"+this.state.chat.activeConversation.id_hashed,{user_id:e},function(e){ChatActions.addEvent(e.event),ChatActions.addUserToConversation(e.event.conversation_id_hashed,e.user)}.bind(this)),this.setState({filter:"",contacts:[]})},_leaveGroup:function(){var e=this;bootbox.dialog({message:translate_conversations_leave_group,title:'<i class="fa fa-warning"></i> <strong>'+translate_msg_warning+"</strong>",buttons:{danger:{label:translate_msg_ok,className:"btn-danger",callback:function(){$.post(BASE_URL+"/convs/leave-conversation",{conversation_id:e.state.chat.activeConversation.id_hashed,user_id:AUTH_HASH_ID},function(t){ContactActions.removeGroupConversation(e.state.chat.activeConversation.id_hashed),ChatActions.closeConversation()}),e.setState({filter:"",contacts:[]})}},main:{label:translate_msg_cancel,className:"btn-default",callback:function(){}}}})},_renameGroup:function(){var e=this;bootbox.prompt({title:translate_conversations_rename_conversation,value:e.state.chat.activeConversation.name,callback:function(t){null!==t&&$.post(BASE_URL+"/convs/rename-conversation/"+e.state.chat.activeConversation.id_hashed,{name:t},function(e){ChatActions.updateConversationName(e.conversation),ContactActions.renameGroupConversation(e.conversation),ChatActions.addEvent(e.event)})}})},_handleResize:function(){var e=document.getElementsByTagName("body")[0];window.innerWidth<=768&&!this.state.chat.minimized&&this.state.chat.conversations.length>0?e.classList.add("chat-fullscreen"):e.classList.remove("chat-fullscreen")},_addFileOwn:function(){var e=window.$('<div class="modal fade" id="file-picker-modal"><div class="modal-body"></div></div>'),t=this;$("#file-picker-modal").remove(),$("body").append(e),e.modal(),e.modal("show"),e.load(BASE_URL+"/files/pick"),$(document).on("click","#file-picker [data-dir]",function(){var e=$(this).data("dir");$("#file-picker-modal").load(e)}),$(document).on("click","#file-picker [data-file]",function(){var a=$(this).data("file");$.post(BASE_URL+"/convs/upload-own/"+t.state.chat.activeConversation.id_hashed,{file:a},function(e){ChatActions.addFile(e.file)}),e.modal("hide").data("bs.modal",null)})},_addFileDropbox:function(){var e=this;Dropbox.choose({success:function(t){$(".oo-file-loader").fadeIn();var a=!1;if($.each(t,function(e,t){var n=t.bytes/1024e3;n>MAX_FILE_SIZE&&(a=!0,$(".oo-file-loader").hide(),fileMessage(sprintf(translate_filesize_too_large,t.name,Math.round(n),MAX_FILE_SIZE)))}),!a){var n=[];_.each(t,function(e){n.push({url:e.link,name:e.name})}),$.post(BASE_URL+"/convs/upload-url/"+e.state.chat.activeConversation.id_hashed,{files:n},function(e){_.each(e.files,function(e){ChatActions.addFile(e)})})}},multiselect:!0,linkType:"direct"})},_addFileGoogle:function(){var e=this;gapi.load("auth",{callback:function(){window.gapi.auth.authorize({client_id:"257117791912-8vga639ifokfmc7m11abn1vovpcunquh.apps.googleusercontent.com",scope:["https://www.googleapis.com/auth/drive"]},function(t){if(t&&!t.error){var a=t.access_token;(new google.picker.PickerBuilder).addView(new google.picker.DocsView).setOAuthToken(a).setDeveloperKey("AIzaSyCpK-HsGqPX7jutwYbwiGqfjJovUF9cv14").setCallback(function(t){"picked"==t.action&&$.post(BASE_URL+"/convs/upload-google/"+e.state.chat.activeConversation.id_hashed,{files:t.docs,token:gapi.auth.getToken().access_token},function(e){_.each(e.files,function(e){ChatActions.addFile(e)})})}).build().setVisible(!0)}})}}),gapi.load("picker")},_addFileOnedrive:function(){var e=this;$("#onedrive-frame").remove();var t=document.createElement("IFRAME");e.props.onedriveBussines?t.setAttribute("src",BASE_URL+"/onedrive"):t.setAttribute("src","https://onedrive.onderwijsonline.nl"),t.setAttribute("id","onedrive-frame"),t.style.width=0,t.style.height=0,document.body.appendChild(t),$("#onedrive-frame").load(function(){if(e.props.onedriveBussines)document.getElementById("onedrive-frame").contentWindow.showPicker("",""),window.onedrivePicked=function(t,a,n){var s=[];_.each(t.values,function(e){s.push({url:e.link,name:e.fileName})}),$.post(BASE_URL+"/convs/upload-url/"+e.state.chat.activeConversation.id_hashed,{files:s},function(e){_.each(e.files,function(e){ChatActions.addFile(e)})})};else{var t={folder:"",callback:""};document.getElementById("onedrive-frame").contentWindow.postMessage(t,"*"),window.addEventListener("message",function(t){if(!0===t.data.onedrive){var a=[];_.each(t.data.files.values,function(e){a.push({url:e.link,name:e.fileName})}),$.post(BASE_URL+"/convs/upload-url/"+e.state.chat.activeConversation.id_hashed,{files:a},function(e){_.each(e.files,function(e){ChatActions.addFile(e)})})}})}})},_addFileLocal:function(){document.getElementById("conversation-hidden-upload").click()},_handleFileLocal:function(e){var t=this,a=new FileReader,n=e.target.files[0];a.onload=function(e){$.post(BASE_URL+"/convs/upload-encoded/"+t.state.chat.activeConversation.id_hashed,{name:n.name,file:e.target.result},function(e){ChatActions.addFile(e.file)})}.bind(n),a.readAsDataURL(n)},_downloadFile:function(e){window.open(BASE_URL+"/convs/file/"+e)},_openProfile:function(e){window.$("#ajax-modal").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-body text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div></div>');var t=window.$("#ajax-modal").modal();t.modal(),t.load(BASE_URL+"/user/view/"+e),t.modal("show")},getInitialState:function(){return{toDisconnect:[],contacts:[],filter:""}},componentDidMount:function(){this.props.channel.bind("new-message",function(e){ChatActions.addMessage(e[0])},this),this.props.channel.bind("new-group-conversation",function(e){ContactActions.addGroupConversation(e.conversation)}),this.props.channel.bind("added-to-conversation",function(e){ChatActions.addEvent(e.event),ChatActions.addUserToConversation(e.event.conversation_id_hashed,e.user)},this),this.props.channel.bind("user-left-conversation",function(e){ChatActions.addEvent(e.event),ChatActions.removeUserFromConversation(e.event.conversation_id_hashed,e.deleted_user)},this),this.props.channel.bind("renamed-conversation",function(e){ChatActions.updateConversationName(e.conversation),ContactActions.renameGroupConversation(e.conversation),ChatActions.addEvent(e.event)},this),this.props.channel.bind("new-file",function(e){e.files?_.each(e.files,function(e){ChatActions.addFile(e)}):ChatActions.addFile(e.file)},this),window.addEventListener("resize",this._handleResize);var e=this.refs.container;e&&(e.scrollTop=e.scrollHeight)},_shouldScroll:!1,componentWillMount:function(){ChatActions.checkNewMessages()},componentWillUpdate:function(){var e=this.refs.container;e&&e.scrollHeight-e.clientHeight<=e.scrollTop+1?this._shouldScroll=!0:this._shouldScroll=!1},componentDidUpdate:function(){var e=this.refs.container;e&&(this._shouldScroll||this.state.chat.forceScroll)&&(e.scrollTop=e.scrollHeight),this.refs.message_input&&!this.state.chat.addingUsers&&this.refs.message_input.focus()},render:function(){this._handleResize();var e=this.state.chat.conversations;if(e.length<1)return React.createElement("div",null);if(this.state.chat.minimized){var t="",a=0;return _.each(e,function(e){e.unread&&(a++,t="text-warning animation-pulse")}.bind(this)),React.createElement("div",{id:"conversations-minimized",onClick:this._toggleMinimized,className:"ellipsis text-center"},React.createElement("span",{className:t},React.createElement("i",{className:"fa fa-comments"})," ",a>0?a:""))}var n=_.map(e,function(e){var t=e.name,a=!1;if(0==e.isgroup){var n=$.grep(e.users,function(e){return e.id!=AUTH_USER_ID});if(1==n.length){var s=_.find(this.state.chat.userStatus,function(e){return e.id_hashed===n[0].id_hashed});s&&1==s.online_status&&(a=!0),t=n[0].name}}var i="";e.unread&&(i="new-message "),this.state.chat.activeConversation.id_hashed==e.id_hashed&&(i="active ");var o="";a?o=React.createElement("span",{className:"text-success pull-right"},React.createElement("i",{className:"fa fa-dot-circle-o"})):0==e.isgroup&&(o=React.createElement("span",{className:"text-muted pull-right"},React.createElement("i",{className:"fa fa-dot-circle-o"})));var c=(1==e.isgroup?"group_conv_":"user_")+e.id_hashed;return React.createElement("li",{className:i,key:c},React.createElement("a",{onClick:this._activeConversation.bind(this,e),href:"javascript:;"},o,React.createElement("span",{className:"name ellipsis"},t)))}.bind(this)),s=[];_.each(this.state.chat.activeConversation.messages,function(e){var t=e.message.split("\n").map(function(e,t){return React.createElement("div",{key:t},e)});e.user.id==AUTH_USER_ID?s.push({date:e.created_at,contents:React.createElement("div",{key:e.id_hashed,className:"message-self"},t)}):this.state.chat.activeConversation.isgroup?s.push({date:e.created_at,contents:React.createElement("div",{key:e.id_hashed,className:"message-other"},React.createElement("img",{className:"img-circle",src:e.user.avatar_small_url}),t,React.createElement("span",{className:"-muted small"},"- ",e.user.name))}):s.push({date:e.created_at,contents:React.createElement("div",{key:e.id_hashed,className:"message-other"},React.createElement("img",{className:"img-circle",src:e.user.avatar_small_url}),t)})}.bind(this)),_.each(this.state.chat.activeConversation.events,function(e){s.push({date:e.created_at,contents:React.createElement("div",{key:e.id_hashed,className:"conversation-event"},React.createElement("small",null,e.text))})}),_.each(this.state.chat.activeConversation.files,function(e){s.push({date:e.created_at,contents:React.createElement("div",{key:e.id_hashed,onClick:this._downloadFile.bind(this,e.id_hashed),className:"conversation-file"},React.createElement("i",{className:"fa fa-file"})," ",React.createElement("a",null,e.name),React.createElement("br",null),React.createElement("small",{className:"text-muted"},e.user.name))})}.bind(this)),s=_.sortBy(s,function(e){return moment(e.date,"DD-MM-YYYY HH:mm:ss").valueOf()});var i=_.groupBy(s,function(e){return moment(e.date,"DD-MM-YYYY HH:mm").startOf("minute").format()}),o=_.map(i,function(e,t){var a=_.map(e,function(e){return e.contents});return React.createElement("div",{key:t},React.createElement("div",{className:"message-timestamp"},moment(t).format("HH:mm DD-MM-YYYY")),React.createElement("div",null,a))}),c="";1==this.state.chat.activeConversation.isgroup&&(c=React.createElement("a",{href:"javascript:void(0)",onClick:this._toggleAddUsers,className:"btn btn-alt btn-sm btn-default"},React.createElement("i",{className:"fa fa-users"})));var r=_.map(this.state.chat.activeConversation.users,function(e){var t=_.find(this.state.chat.userStatus,function(t){return t.id_hashed===e.id_hashed}),a=!1;t&&1==t.online_status&&(a=!0);var n=React.createElement("span",{className:"text-muted pull-right"},React.createElement("i",{className:"fa fa-dot-circle-o"}));return a&&(n=React.createElement("span",{className:"text-success pull-right"},React.createElement("i",{className:"fa fa-dot-circle-o"}))),React.createElement("div",{key:e.id_hashed,className:"chat-member"},React.createElement("img",{src:e.avatar_small_url,alt:"avatar",className:"img-circle pull-left"}),n,React.createElement("strong",{onClick:this._openProfile.bind(this,e.id_hashed)},e.name),React.createElement("div",{className:"clearfix"}))}.bind(this)),l=0,d=_.map(this.state.contacts,function(e){return _.filter(this.state.chat.activeConversation.users,function(t){return t.id_hashed==e.id_hashed})<1&&(l++,React.createElement("div",{key:e.id_hashed,className:"chat-add-users-result"},React.createElement("i",{onClick:this._addUserToConversation.bind(this,e.id_hashed),className:"fa fa-plus-circle pull-right add-user-btn"}),React.createElement("img",{src:e.avatar_small_url,alt:"avatar",className:"img-circle pull-left"}),React.createElement("strong",{onClick:this._openProfile.bind(this,e.id_hashed)},e.name),React.createElement("div",{className:"clearfix"})))}.bind(this));l<1&&this.state.filter.length>0&&(d=React.createElement("div",{className:"alert alert-info text-center"},translate_no_results_found));var h=void 0;if(this.state.chat.addingUsers){var u="",v="";this.state.chat.activeConversation.has_project||(u=React.createElement("div",{className:"chat-add-users-filter"},React.createElement("input",{placeholder:"Toevoegen..",onKeyUp:this._filterContacts,type:"text",ref:"contactFilterInput",className:"form-control"})),v=React.createElement("div",{className:"group-options"},React.createElement("div",{onClick:this._renameGroup,className:"btn btn-block btn-default"},translate_conversations_rename_conversation),React.createElement("div",{onClick:this._leaveGroup,className:"btn btn-block btn-danger"},translate_conversations_leave_group))),h=React.createElement("div",{className:"chat-add-users"},u,React.createElement("div",{className:"chat-add-users-results"},d),React.createElement("div",{className:"chat-member-list"},r),v)}var m="";if(0==this.state.chat.activeConversation.isgroup){var f=_.find(this.state.chat.activeConversation.users,function(e){return e.id_hashed!=AUTH_HASH_ID});f&&(m=React.createElement("a",{onClick:this._openProfile.bind(this,f.id_hashed),className:"btn btn-alt btn-sm btn-default"},React.createElement("i",{className:"fa fa-user"})))}return React.createElement("div",{id:"conversations-open"},React.createElement("div",{className:"left-side"},React.createElement("div",{className:"title",onClick:this._toggleMinimized},translate_conversations),React.createElement("ul",null,n)),React.createElement("div",{className:"options"},React.createElement("div",{className:"btn-group btn-group-sm"},React.createElement("a",{href:"javascript:void(0)",className:"btn btn-alt btn-sm btn-default dropdown-toggle enable-tooltip","data-toggle":"dropdown",title:"","aria-expanded":"false"},React.createElement("i",{className:"gi gi-file"})),React.createElement("ul",{className:"dropdown-menu dropdown-custom dropdown-menu-left"},React.createElement("li",null,React.createElement("a",{onClick:this._addFileOwn,href:"javascript:void(0)"},React.createElement("i",{className:"gi gi-folder_closed pull-right"})," ",translate_conversations_files),React.createElement("a",{onClick:this._addFileDropbox,href:"javascript:void(0)"},React.createElement("i",{className:"fa fa-dropbox pull-right"})," Dropbox"),React.createElement("a",{onClick:this._addFileGoogle,href:"javascript:void(0)"},React.createElement("i",{className:"fa fa-google pull-right"})," Google Drive"),React.createElement("a",{onClick:this._addFileOnedrive,href:"javascript:void(0)"},React.createElement("i",{className:"fa fa-windows pull-right"})," OneDrive"),React.createElement("a",{onClick:this._addFileLocal,href:"javascript:void(0)"},React.createElement("i",{className:"fa fa-folder-open pull-right"})," ",translate_conversations_browse))),React.createElement("input",{type:"file",id:"conversation-hidden-upload",onChange:this._handleFileLocal})),m,c,React.createElement("div",{className:"pull-right"},React.createElement("a",{onClick:this._closeConversation,href:"javascript:void(0)",className:"btn btn-alt btn-sm btn-default"},React.createElement("i",{className:"fa fa-times"})))),h,React.createElement("div",{className:"messages",ref:"container"},o),React.createElement("div",{className:"new-message"},React.createElement("textarea",{rows:"1",onKeyUp:this._addMessage,ref:"message_input",className:"form-control",placeholder:translate_conversations_message}),React.createElement("a",{onClick:this._addMessage,className:"btn btn-xs btn-primary"},React.createElement("i",{className:"fa fa-arrow-circle-right"}))))}});localStorageAvailable()&&ReactDOM.render(React.createElement(n,{channel:pusherUserChannel,onedriveBussines:onedriveBussines}),document.getElementById("conversations"))},"Vw7+":function(e,t,a){"use strict";var n=a("mvHQ"),s=function(e){return e&&e.__esModule?e:{default:e}}(n);window.ChatActions=Reflux.createActions(["clearLocalStorage","addUserConversation","addConversation","closeConversation","toggleMinimized","setActiveConversation","addMessage","checkNewMessages","updateConversationName","addFile","addEvent","removeUserFromConversation","addUserToConversation","addOnlineContact","removeOnlineContact","toggleAddingUsers"]);window.ChatStore=Reflux.createStore({listenables:[ChatActions],onClearLocalStorage:function(){localStorage.clear()},onToggleAddingUsers:function(){this.addingUsers=!this.addingUsers,this.updateState()},onAddOnlineContact:function(e){var t=_.find(this.userStatus,function(t){return t.id_hashed===e.id_hashed}.bind(this));t?t.online_status=1:(e.online_status=1,this.userStatus.push(e)),this.updateState()},onRemoveOnlineContact:function(e){this.userStatus=_.without(this.userStatus,_.findWhere(this.userStatus,{id_hashed:e.id_hashed})),this.updateState()},onRemoveUserFromConversation:function(e,t){var a=_.find(this.conversations,function(t){return t.id_hashed===e}.bind(this));a&&(a.users=_.without(a.users,_.findWhere(a.users,{id_hashed:t.id_hashed})),this.updateState())},onAddEvent:function(e){var t=_.find(this.conversations,function(t){return t.id_hashed===e.conversation_id_hashed}.bind(this));t?(t.events.push(e),this.activeConversation.id_hashed===e.conversation_id_hashed&&(this.activeConversation=t),t.unread=!0,this.minimized||this.activeConversation.id_hashed!=e.conversation_id_hashed||(t.unread=!1),this.updateState()):this.onAddConversation(e.conversation_id_hashed)},onAddFile:function(e){var t=_.find(this.conversations,function(t){return t.id_hashed===e.conversation_id_hashed}.bind(this));t?(t.files.push(e),this.activeConversation.id_hashed===e.conversation_id_hashed&&(this.activeConversation=t),t.unread=!0,this.minimized||this.activeConversation.id_hashed!=e.conversation_id_hashed||(t.unread=!1),this.updateState()):this.onAddConversation(e.conversation_id_hashed)},onUpdateConversationName:function(e){var t=_.find(this.conversations,function(t){return t.id_hashed=e.id_hashed});t&&(t.name=e.name),this.activeConversation&&e.id_hashed==this.activeConversation.id_hashed&&(this.activeConversation.name=e.name),this.updateState()},onCheckNewMessages:function(){var e=[];_.each(this.conversations,function(t){var a=t.messages[t.messages.length-1];a&&e.push({conversation_id:t.id_hashed,message_id:a.id_hashed})}),$.post(BASE_URL+"/convs/check-new-messages",{conversations:e},function(e){_.each(e,function(e){var t=_.find(this.conversations,function(t){return t.id_hashed===e.conversation_id_hashed}.bind(this));t&&(t.messages.push(e),t.unread=!0,t.id_hashed==this.activeConversation.id_hashed&&(this.minimized||(t.unread=!1),this.activeConversation=t))}.bind(this)),this.updateState()}.bind(this))},onAddMessage:function(e){var t=_.find(this.conversations,function(t){return t.id_hashed===e.conversation.id_hashed}.bind(this));t?(t.messages.push(e),this.activeConversation.id_hashed===e.conversation.id_hashed&&(this.activeConversation=t),t.unread=!0,this.minimized||this.activeConversation.id_hashed!=e.conversation.id_hashed||(t.unread=!1),this.updateState()):this.onAddConversation(e.conversation.id_hashed)},onSetActiveConversation:function(e,t){if(this.activeConversation.id_hashed!=e.id_hashed){var a=_.find(this.conversations,function(t){return t.id_hashed===e.id_hashed}.bind(this));a.unread&&this.markConversationRead(a.id_hashed),a.unread=!1,this.activeConversation=a,this.addingUsers=!1,t&&(this.forceScroll=!0),this.updateState()}},onAddUserToConversation:function(e,t){var a=_.find(this.conversations,function(t){return t.id_hashed===e}.bind(this));a?(a.users.push(t),a.unread=!0,this.minimized||this.activeConversation.id_hashed!=e||(a.unread=!1),this.addingUsers=!1,this.updateState()):this.onAddConversation(e)},onAddConversation:function(e,t){var a=_.filter(this.conversations,function(t){return t.id_hashed==e});this.addingUsers=!1,a.length<1?$.get(BASE_URL+"/convs/conversation/"+e,function(e){this.activeConversation=e,this.conversations.unshift(e),t&&(this.minimized=!1,this.forceScroll=!0),this.updateState()}.bind(this)):(t&&(this.activeConversation=a[0],this.minimized=!1,this.forceScroll=!0),this.updateState())},onAddUserConversation:function(e,t){var a=_.filter(this.conversations,function(t){return _.filter(t.users,function(a){return a.id_hashed==e&&0==t.isgroup}).length>0});this.addingUsers=!1,a.length<1?$.get(BASE_URL+"/convs/conversation-with-user/"+e,function(e){this.conversations.unshift(e),this.activeConversation=e,t&&(this.minimized=!1,this.forceScroll=!0),this.updateState()}.bind(this)):(t&&(this.activeConversation=a[0],this.minimized=!1,this.forceScroll=!0),this.updateState())},onToggleMinimized:function(){this.minimized&&this.markConversationRead(this.activeConversation.id_hashed),this.addingUsers=!1,this.minimized=!this.minimized,this.activeConversation.unread=!1,this.forceScroll=!0,this.updateState()},onCloseConversation:function(){this.conversations=$.grep(this.conversations,function(e){return e.id_hashed!==this.activeConversation.id_hashed}.bind(this)),this.addingUsers=!1,this.conversations[0]?this.activeConversation=this.conversations[0]:(this.activeConversation=null,this.minimized=!0),this.updateState()},markConversationRead:function(e){$.ajax(BASE_URL+"/convs/mark-conversation-as-read/"+e)},updateState:function(){var e={conversations:this.conversations,activeConversation:this.activeConversation,minimized:this.minimized,userStatus:this.userStatus,addingUsers:this.addingUsers,forceScroll:this.forceScroll};localStorage.setItem("active_conversations",(0,s.default)(e)),this.trigger(e),this.forceScroll=!1},getInitialState:function(){var e=localStorage.getItem("active_conversations");return e?(e=JSON.parse(e),this.conversations=e.conversations,this.activeConversation=e.activeConversation,this.minimized=e.minimized,this.addingUsers=e.addingUsers):(this.conversations=[],this.activeConversation=null,this.minimized=!0,this.addingUsers=!1),this.userStatus=[],this.forceScroll=!1,{conversations:this.conversations,activeConversation:this.activeConversation,minimized:this.minimized,userStatus:this.userStatus,addingUsers:this.addingUsers,forceScroll:this.forceScroll}}})},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(e,t,a){var n=a("FeBl"),s=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}}});
//# sourceMappingURL=chat.js.map